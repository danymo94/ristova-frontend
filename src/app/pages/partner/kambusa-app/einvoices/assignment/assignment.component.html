<!-- Dialog per conferma assegnazione a centro di costo -->
<p-dialog
  header="Conferma Assegnazione"
  [(visible)]="costCenterAssignDialogVisible"
  [modal]="true"
  [style]="{ width: '450px' }"
  [draggable]="false"
  [resizable]="false"
>
  <div *ngIf="selectedInvoiceForCostCenter" class="p-fluid">
    <p class="mb-3">
      Sei sicuro di voler assegnare questa fattura al centro di costo
      selezionato?
    </p>

    <div class="p-3 bg-gray-50 border-round mb-3">
      <p class="mb-1">
        <strong>Fattura:</strong> #{{
          selectedInvoiceForCostCenter.invoiceNumber
        }}
      </p>
      <p class="mb-1">
        <strong>Fornitore:</strong>
        {{ getSupplierName(selectedInvoiceForCostCenter.supplierId) }}
      </p>
      <p class="mb-1">
        <strong>Importo:</strong>
        {{ selectedInvoiceForCostCenter.totalAmount | currency : "EUR" }}
      </p>
      <p class="mb-0">
        <strong>Centro di costo:</strong>
        {{ getWarehouseById(selectedCostCenterId)?.name || "N/D" }}
      </p>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <button
      pButton
      label="Annulla"
      icon="pi pi-times"
      class="p-button-text"
      (click)="closeCostCenterAssignDialog()"
    ></button>
    <button
      pButton
      label="Conferma"
      icon="pi pi-check"
      [loading]="assigningToWarehouse"
      (click)="confirmCostCenterAssignment()"
    ></button>
  </ng-template>
</p-dialog>

<!-- Dialog per scelta modalità di valorizzazione magazzino -->
<p-dialog
  header="Valorizzazione Magazzino"
  [(visible)]="warehouseValuationDialogVisible"
  [modal]="true"
  [style]="{ width: '500px' }"
  [draggable]="false"
  [resizable]="false"
>
  <div *ngIf="selectedInvoiceForWarehouse" class="p-fluid">
    <p class="mb-3">
      Come desideri valorizzare il magazzino con questa fattura?
    </p>

    <div class="p-3 bg-gray-50 border-round mb-3">
      <p class="mb-1">
        <strong>Fattura:</strong> #{{
          selectedInvoiceForWarehouse.invoiceNumber
        }}
      </p>
      <p class="mb-1">
        <strong>Fornitore:</strong>
        {{ getSupplierName(selectedInvoiceForWarehouse.supplierId) }}
      </p>
      <p class="mb-1">
        <strong>Importo:</strong>
        {{ selectedInvoiceForWarehouse.totalAmount | currency : "EUR" }}
      </p>
      <p class="mb-0">
        <strong>Magazzino:</strong>
        {{ getWarehouseById(selectedWarehouseId)?.name || "N/D" }}
      </p>
    </div>

    <div class="mb-3">
      <div class="flex flex-column gap-3">
        <div class="p-field-radiobutton">
          <p-radioButton
            name="valuationType"
            value="total"
            [(ngModel)]="valuationType"
            inputId="valuationType_total"
          ></p-radioButton>
          <label for="valuationType_total" class="ml-2">
            Valorizza intero importo fattura
          </label>
        </div>

        <div class="p-field-radiobutton">
          <p-radioButton
            name="valuationType"
            value="partial"
            [(ngModel)]="valuationType"
            inputId="valuationType_partial"
          ></p-radioButton>
          <label for="valuationType_partial" class="ml-2">
            Valorizza solo alcune righe della fattura
          </label>
        </div>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <button
      pButton
      label="Annulla"
      icon="pi pi-times"
      class="p-button-text"
      (click)="closeWarehouseValuationDialog()"
    ></button>
    <button
      pButton
      label="Procedi"
      icon="pi pi-check"
      [loading]="assigningToWarehouse"
      (click)="confirmWarehouseValuation()"
    ></button>
  </ng-template>
</p-dialog>

<!-- Dialog per selezione parziale delle righe fattura -->
<p-dialog
  header="Seleziona Righe Fattura"
  [(visible)]="partialSelectionDialogVisible"
  [modal]="true"
  [style]="{ width: '80%', maxWidth: '900px' }"
  [draggable]="false"
  [resizable]="false"
>
  <div *ngIf="selectedInvoiceForWarehouse" class="p-fluid">
    <p class="mb-3">
      Seleziona le righe della fattura che desideri valorizzare nel magazzino:
    </p>

    <p-table
      [value]="selectedInvoiceForWarehouse.invoiceLines || []"
      [(selection)]="selectedInvoiceLines"
      styleClass="p-datatable-sm"
      [scrollable]="true"
      [rowHover]="true"
    >
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 3rem">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th>Codice</th>
          <th>Descrizione</th>
          <th class="text-right">Qtà</th>
          <th class="text-right">U.M.</th>
          <th class="text-right">Prezzo Unitario</th>
          <th class="text-right">Totale</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-line let-i="rowIndex">
        <tr>
          <td>
            <p-tableCheckbox [value]="line"></p-tableCheckbox>
          </td>
          <td>{{ line.articleCode }}</td>
          <td>{{ line.description }}</td>
          <td class="text-right">{{ line.quantity }}</td>
          <td class="text-right">{{ line.unitOfMeasure }}</td>
          <td class="text-right">{{ line.unitPrice | currency : "EUR" }}</td>
          <td class="text-right">{{ line.totalPrice | currency : "EUR" }}</td>
        </tr>
      </ng-template>
    </p-table>

    <div class="mt-3">
      <p>
        <strong>Righe selezionate:</strong> {{ selectedInvoiceLines.length }}
      </p>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <button
      pButton
      label="Annulla"
      icon="pi pi-times"
      class="p-button-text"
      (click)="closePartialSelectionDialog()"
    ></button>
    <button
      pButton
      label="Conferma selezione"
      icon="pi pi-check"
      [disabled]="selectedInvoiceLines.length === 0"
      [loading]="assigningToWarehouse"
      (click)="confirmPartialSelection()"
    ></button>
  </ng-template>
</p-dialog>
